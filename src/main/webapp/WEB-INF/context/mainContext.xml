<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:util="http://www.springframework.org/schema/util"
       xmlns:context="http://www.springframework.org/schema/context" xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd">

    <!--IMPORTANT-->
    <context:component-scan base-package="com.aimprosoft.sandbox"/>

    <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="location" value="application.properties"/>
    </bean>

    <!--HIBERNATE AND JDBC-->
    <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
        <property name="driverClassName" value="${jdbc.driverClassName}"/>
        <property name="url" value="${database.url}"/>
        <property name="username" value="${database.user}"/>
        <property name="password" value="${database.password}"/>
    </bean>


    <bean id="sessionFactory" class="org.springframework.orm.hibernate5.LocalSessionFactoryBean">
        <property name="dataSource" ref="dataSource"/>
        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.hbm2ddl.auto">${hibernate.hbm2ddl.auto}</prop>
                <prop key="hibernate.dialect">${hibernate.dialect}</prop>
                <prop key="hibernate.generate_statistics">${hibernate.generate_statistics}</prop>
                <prop key="hibernate.use_sql_comments">${hibernate.use_sql_comments}</prop>
                <prop key="show_sql">${show_sql}</prop>
                <prop key="format_sql">${format_sql}</prop>
                <prop key="connection.pool_size">${connection.pool_size}</prop>
                <prop key="current_session_context_class">${current_session_context_class}</prop>
                <prop key="javax.persistence.validation.mode">${javax.persistence.validation.mode}</prop>
            </props>
        </property>
        <property name="packagesToScan" value="com.aimprosoft.sandbox.domain"/>
    </bean>

    <bean id="databaseManager" class="com.aimprosoft.sandbox.util.database.DatabaseManager">
        <constructor-arg index="0" type="java.lang.String" value="${database.url}"/>
        <constructor-arg index="1" type="java.lang.String" value="${database.user}"/>
        <constructor-arg index="2" type="java.lang.String" value="${database.password}"/>
    </bean>

    <!--TRANSACTION-->
    <tx:annotation-driven/>
    <bean id="transactionManager"
          class="org.springframework.orm.hibernate5.HibernateTransactionManager">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <!--DAOs-->
    <bean id="hibernateEmployeeRepo" class="com.aimprosoft.sandbox.dao.impl.hibernate.HibernateEmployeeRepoImpl"/>
    <bean id="hibernateDepartmentRepo" class="com.aimprosoft.sandbox.dao.impl.hibernate.HibernateDepartmentRepoImpl"/>

    <bean id="springDepartmentRepo" class="com.aimprosoft.sandbox.dao.impl.spring_orm.SpringOrmDepartmentRepoImpl">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="springEmployeeRepo" class="com.aimprosoft.sandbox.dao.impl.spring_orm.SpringOrmEmployeeRepoImpl">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>

    <bean id="jdbcDepartmentRepo" class="com.aimprosoft.sandbox.dao.impl.jdbc.DepartmentRepoImpl"/>
    <bean id="jdbcEmployeeRepo" class="com.aimprosoft.sandbox.dao.impl.jdbc.EmployeeRepoImpl"/>

    <!--SERVICES-->
    <bean id="employeeService" class="com.aimprosoft.sandbox.service.impl.EmployeeServiceImpl">
        <property name="repo" ref="springEmployeeRepo"/>
    </bean>

    <bean id="departmentService" class="com.aimprosoft.sandbox.service.impl.DepartmentServiceImpl">
        <property name="repo" ref="springDepartmentRepo"/>
    </bean>

    <!--ACTIONS-->

    <!--GET-->
    <bean id="getDepartments" class="com.aimprosoft.sandbox.controller.action.get.DepartmentsPage"/>
    <bean id="getEmployees" class="com.aimprosoft.sandbox.controller.action.get.EmployeesPage"/>
    <bean id="error" class="com.aimprosoft.sandbox.controller.action.get.ErrorPage"/>

    <!--POST-->
    <bean id="addDepartment" class="com.aimprosoft.sandbox.controller.action.post.department.AddNewDepartment"/>
    <bean id="deleteDepartment" class="com.aimprosoft.sandbox.controller.action.post.department.DeleteDepartment"/>
    <bean id="editDepartment" class="com.aimprosoft.sandbox.controller.action.post.department.EditDepartment"/>

    <bean id="addEmployee" class="com.aimprosoft.sandbox.controller.action.post.employee.AddNewEmployee"/>
    <bean id="deleteEmployee" class="com.aimprosoft.sandbox.controller.action.post.employee.DeleteEmployee"/>
    <bean id="editEmployee" class="com.aimprosoft.sandbox.controller.action.post.employee.EditEmployee"/>

    <!--ACTION MAP-->
    <util:map id="actionMap" value-type="java.util.List">

        <entry key="/departments" value-ref="getDepartments"/>
        <entry key="/employees" value-ref="getEmployees"/>
        <entry key="/error" value-ref="error"/>

        <entry key="/departments/add" value-ref="addDepartment"/>
        <entry key="/departments/delete" value-ref="deleteDepartment"/>
        <entry key="/departments/edit" value-ref="editDepartment"/>

        <entry key="/employees/add" value-ref="addEmployee"/>
        <entry key="/employees/delete" value-ref="deleteEmployee"/>
        <entry key="/employees/edit" value-ref="editEmployee"/>

    </util:map>

    <!--ACTION MANAGER-->
    <bean id="actionManager" class="com.aimprosoft.sandbox.controller.action.ActionManager">
        <property name="actions" ref="actionMap"/>
    </bean>

    <!--VALIDATOR-->
    <bean id="validator" class="com.aimprosoft.sandbox.util.validator.OvalValidator"/>

    <bean class="net.sf.oval.integration.spring.SpringInjector"/>
</beans>